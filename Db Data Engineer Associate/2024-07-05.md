## Querying files contd.
- querying data files directly
	- ```SELECT * from json.`/path/to/file_name.json` ```
		- is this path supposed to be within dbfs? #doubt
- extract files as raw contents
	- extract text files as raw strings
		- when working with text based files which include csv, tsv and txt format
		- SELECT * from text.\`/path/to/file\`
		- this extracts data as raw strings
			- raw strings treat the back slash char as a literal character
		- this can be useful when input data could be corrupted
		- later custom text parsing functions can be used to extract values from text files
	- extract files as raw bytes
		- when we need binary rep of files content, when dealing with images and unstructured data
		- why would we need binary rep of file content?  #doubt
		- ```SELECT * from binaryFile.`/path/to/file` ```
- Configure options for external sources
	- registering tables from files
	- the above ***select statements*** can be used as part of CTAS in DLH
		- ```CREATE TABLE table_name AS SELECT * from file_format.`/path/to/file` ```
	- as CTAS does not support manual schema definition, this method of table definition works well with ***external sources with well-defined schema***
		- such as parquet files and tables
	- CTAS statements do not support defining additional file options
		- significant ***limitation*** when trying to ingest data from ***CSV files***
	- for CSVs it is helpful to provide OPTIONS and for this we can make use of USING keyword
		- ```CREATE TABLE table_name (col_name1 col_type1,...) USING external_data_source_type OPTIONS(key1=val1,key2=val2,...) LOCATION = path```
		- this command always creates an external table unlike the above CTAS
		- the table is just a reference to the files
		- there is no ***data moving*** during table creation
		- we are just pointing to files stored in an external location
			- so it can be outside dbfs?  #doubt
			- how is it diff from an external table which has data inside dbfs?  #doubt
		- the format of the files are left unchanged, which means we are creating a non delta table
			- if we create an ext table with data within dbfs and location clause(instead of USING) does it change the file format? #doubt
		- `CREATE TABLE table_name (col_name1 col_type1,...) USING CSV OPTIONS (header="true", delimiter=";") LOCATION = path`
		- creating a table using JDBC connection to refer to data in an external SQL DB
			- `CREATE TABLE table_name (col_name1 col_type1,...) USING JDBC OPTONS(url="jdbc:sqlite://hostname:port", dbtable="database.table", user="username", password="pwd")`
			- obviously querying a huge database table can cause performance issues
		- this is not a delta table
		- performance and features of Delta lake are no more guaranteed, when we are dealing with non-delta tables
			- ex: time travel, guarantee that we are always reading the most recent version of data
	- since CTAS cannot be used with schema definition or options, a soln can be:
		- create a temp view on top of the external source:
			- `CREATE TEMP VIEW temp_view_name (col_name1 col_type1,...) USING data_source OPTIONS (key1=val1, key2= val2)`
				- path to the source comes inside the options
				- ![[Pasted image 20240715093612.png]]
			- so at least temp views can be created on top of external sources and with schema def and options
			- can view definitions point to a location? #doubt
			- how is the above different from an external table? #doubt 
		- using CTAS on the view, create a table
			- `CREATE TABLE table_name as SELECT * from temp_view_name`
			- so ctas statements can be used to query files, tables and views
			- this alternate solution can be used when we want to create a managed table
- is the delta log folder(with jsons) created for an external table
	- yep, it is created
	- are delta lake features applicable for external table? #doubt