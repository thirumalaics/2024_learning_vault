## Comparing BTrees and LSM Trees
- BT more ***mature*** than LSM-tree(Log-structured Merge tree)
- LSM are typically ***faster for writes***
- Btrees are typically ***faster for reads***
- reads are typically slower on LSMT because they have to ***scan more*** dss at different stages of compaction
- note the use of words ***typically*** above
	- benchmarks are inconclusive
	- the performance is very much sensitive to the workload
- following are things that are worth considering when measuring the performance of a storage engine

### Advantages of LSMT
- BTrees must write ***at least twice***:
	- once to WAL and once to the tree page itself
	- may be once more if the pages are split
- BTrees ***write the entire page every time*** even if only a few bytes changed
- some storage engines ***overwrite the same page twice*** in order to avoid partially updated pages
- LSMT also rewrite data multiple times due to ***repeated compaction and merging***
- one write to db results in multiple writes to disk over db's lifetime
	- called ***write amplification***
	- write amplification can be a concern if we are ***using SSDs***
		- SSds can only ***overwrite blocks*** a limited number of times before ***wearing out***
	- write amplification is common to BT and LSMT
		- but just that BT has overwrites and LSMT has appends
- in write heavy apps, the performance bottleneck might be the ***rate at which the db can write to disk***
	- in this case, write amplification has a direct performance cost:
		- more a storage engine writes to disk, the fewer writes per second it can handle within the available disk bw
			- by more here, I think they mean writes that occur as a result of write amplification
				- if these writes are more than the disk bw, disk cannot cater to new incoming write requests
				- writes due to WA can be splitting and overwrites of pages in BT and compaction and merging in LSMT
				- check the next point after disk bw definition
		- what is disk bandwidth:
			- total number of bytes transferred(for write or read) / total time bw the first request for service and the completion on the last transfer
	- LSMT can sustain ***higher write throughput*** than BTs due to two reasons:
		- because they have ***lower write amplification***
			- this depends on the storage engine config and workload
		- because they sequentially write compact SSTf rather than having to overwrite several pages in the tree
			- particularly important on Magnetic HD
				- because having sequential writes increases throughput as there are ***no seeks***
- LSMT can be ***compressed better***
	- thus they produce smaller files on disk than BTrees
- BTree leave some disk space unused due to fragmentation
	- fragmentation: when a page is split or when a row cannot fit into an existing page, some space in a page remains unused
		- this leads to the ***page being stored in a non-contiguous location***
- LSMT avoid fragmentation as they do compaction
- on many SSDs, the ***firmware*** internally uses a log-structured algorithm to ***turn random writes into sequential writes*** on the underlying storage chips
	- firmware: a form of ***microcode*** or program embedded into HW devices to help them operate effectively
	- microcode: microprocessor instructions
	- this does not mean lower WA will not affect performance
	- lower write amplification and reduced fragmentation are still advantageous on SSDs
		- representing more data compactly allows more read and write requests within the available IO bandwidth